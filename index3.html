<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Testing Pie Chart</title>
    <!--<script type="text/javascript" src="d3/d3.v2.js"></script>-->
    <script src="https://d3js.org/d3.v4.js"></script>
    <!-- Load color scale -->
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <!-- Note: I made good use of the sample code provided by the D3JS community and extended it to fit my needs to create this simple dashboard -->
    <style type="text/css">
        #bubbleChart {
            position: absolute;
            top: 10px;
            left: 50px;
            width: 400px;
            height: 400px;
        }



        #histogram {
            position: absolute;
            top: 50px;
            left: 700px;
            height: 400px;
        }

        #connectedScatter {
            position: absolute;
            top: 500px;
            left: 50px;
            height: 400px;
        }

        #heatmap {
            position: absolute;
            top: 500px;
            left: 700px;
            height: 400px;
        }

        #pieChart {
            position: absolute;
            top: 500px;
            left: 50px;
            height: 400px;
        }

        .slice {
            font-size: 12pt;
            font-family: Verdana;
            fill: white;
            /*svg specific - instead of color*/
            font-weight: bold;
        }

        /*for line chart*/
        .axis path,
        .axis line {
            fill: none;
            stroke: black;
            shape-rendering: crispEdges;
            /*The shape-rendering property is an SVG attribute, used here to make sure our axis and its tick mark lines are pixel-perfect. */
        }

        .line {
            fill: none;
            /*stroke: steelblue;*/
            stroke-width: 3px;
        }

        .dot {
            /*fill: white;*/
            /*stroke: steelblue;*/
            stroke-width: 1.5px;
        }


        .axis text {
            font-family: Verdana;
            font-size: 11px;
        }

        .title {
            font-family: Verdana;
            font-size: 15px;

        }

        .xAxis {
            font-family: verdana;
            font-size: 11px;
            fill: black;
        }

        .yAxis {
            font-family: verdana;
            font-size: 11px;
            fill: white;
        }


        table {
            border-collapse: collapse;
            border: 0px;
            font-family: Verdana;
            color: #5C5558;
            font-size: 12px;
            text-align: right;
        }

        td {
            padding-left: 10px;
        }

        #histogramTitle1 {
            font-family: Verdana;
            font-size: 14px;
            fill: lightgrey;
            font-weight: bold;
            text-anchor: middle;
        }

        #histogramTitle2 {
            font-family: Verdana;
            font-size: 72px;
            fill: grey;
            text-anchor: middle;
            font-weight: bold;
            /*font-style: italic;*/
        }
    </style>
</head>

<body>

    <div id="bubbleChart"></div>
    <div id="connectedScatter"></div>
    <div id="histogram">
        <p>
            <label>Change number of bins</label>
            <input type="number" min="1" max="100" step="10" value="20" id="nBin">
        </p>
    </div>
    <div id="heatmap"></div>
    <div id="pieChart"></div>
    <script type="text/javascript">


        function createBubbleChart() {

            // set the dimensions and margins of the graph
            var margin = { top: 10, right: 30, bottom: 30, left: 60 },
                width = 500 - margin.left - margin.right,
                height = 450 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#bubbleChart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            //Read the data
            d3.csv("https://raw.githubusercontent.com/IsaacMwendwa/dataViz/main/a1-cars.csv", function (data) {


                // Defining graph title and axis labels
                const xAxisLabel = "Horsepower";
                const yAxisLabel = "Acceleration";
                const title = `Bubble Chart of MPG vs ${yAxisLabel}, ${xAxisLabel} and Origin of Cars`;

                //Create Title 
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", 0)
                    .style("text-anchor", "middle")
                    .text(title);

                //Create X axis label   
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom)
                    .style("text-anchor", "middle")
                    .text(xAxisLabel);

                //Create Y axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(yAxisLabel);

                // Add X axis
                var x = d3.scaleLinear()
                    .domain([30, 300])
                    .range([0, width]);
                var xAxis = svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 30])
                    .range([height, 0]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // Add a clipPath: everything out of this area won't be drawn.
                var clip = svg.append("defs").append("svg:clipPath")
                    .attr("id", "clip")
                    .append("svg:rect")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("z", 0);

                // Add a scale for bubble size
                var z = d3.scaleLinear()
                    .domain([0, 50])
                    .range([0, 20]);


                // list of keys
                var keys = ["American", "Japanese", "European"]


                // Add a scale for bubble color
                var color = d3.scaleOrdinal()
                    .domain(keys)
                    .range(d3.schemeSet1);


                // Add one dot in the legend for each name.
                var size = 20
                svg.selectAll("mydots")
                    .data(keys)
                    .enter()
                    .append("rect")
                    .attr("x", 300)
                    .attr("y", function (d, i) { return 20 + i * (size + 5) }) // 100 is where the first dot appears. 25 is the distance between dots
                    .attr("width", size)
                    .attr("height", size)
                    .style("fill", function (d) { return color(d) })


                //Add one dot in the legend for each name.
                svg.selectAll("mylabels")
                    .data(keys)
                    .enter()
                    .append("text")
                    .attr("x", 300 + size * 1.2)
                    .attr("y", function (d, i) { return 20 + i * (size + 5) + (size / 2) }) // 100 is where the first dot appears. 25 is the distance between dots
                    .style("fill", function (d) { return color(d) })
                    .text(function (d) { return d })
                    .attr("text-anchor", "left")
                    .style("alignment-baseline", "middle")


                // Add brushing
                var brush = d3.brushX()                 // Add the brush feature using the d3.brush function
                    .extent([[0, 0], [width, height]]) // initialise the brush area: start at 0,0 and finishes at width,height: it means I select the whole graph area
                    .on("end", updateChart) // Each time the brush selection changes, trigger the 'updateChart' function

                // Create the scatter variable: where both the circles and the brush take place
                var scatter = svg.append('g')
                    .attr("clip-path", "url(#clip)")

                // Add circles
                scatter
                    .selectAll("circle")
                    .data(data)
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) { return x(d.Horsepower); })
                    .attr("cy", function (d) { return y(d.Acceleration); })
                    .attr("r", function (d) { return z(d.MPG); })
                    .style("fill", function (d) { return color(d.Origin) })
                    .style("opacity", 0.5)


                // Add the brushing
                scatter
                    .append("g")
                    .attr("class", "brush")
                    .call(brush);

                // A function that set idleTimeOut to null
                var idleTimeout
                function idled() { idleTimeout = null; }

                // A function that update the chart for given boundaries
                function updateChart() {

                    extent = d3.event.selection

                    // If no selection, back to initial coordinate. Otherwise, update X axis domain
                    if (!extent) {
                        if (!idleTimeout) return idleTimeout = setTimeout(idled, 350); // This allows to wait a little bit
                        x.domain([30, 300])
                    } else {
                        x.domain([x.invert(extent[0]), x.invert(extent[1])])
                        scatter.select(".brush").call(brush.move, null) // This remove the grey brush area as soon as the selection has been done
                    }

                    // Update axis and circle position
                    xAxis.transition().duration(1000).call(d3.axisBottom(x))
                    scatter
                        .selectAll("circle")
                        .transition().duration(1000)
                        .attr("cx", function (d) { return x(d.Horsepower); })
                        .attr("cy", function (d) { return y(d.Acceleration); })
                        .attr("r", function (d) { return z(d.MPG); })

                }



            })

        }

        createBubbleChart();

        function createHistogram() {

            // set the dimensions and margins of the graph
            var margin = { top: 10, right: 30, bottom: 30, left: 40 },
                width = 480 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#histogram")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // get the data
            d3.csv("https://raw.githubusercontent.com/IsaacMwendwa/dataViz/main/a1-cars.csv", function (data) {


                // Defining graph title and axis labels
                const xAxisLabel = "Number of Cylinders";
                const yAxisLabel = "Frequency";
                const title = `Histogram showing ${yAxisLabel} of ${xAxisLabel} of Car Engines`;

                //Create Title 
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", 0)
                    .style("text-anchor", "middle")
                    .text(title);

                //Create X axis label   
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom)
                    .style("text-anchor", "middle")
                    .text(xAxisLabel);

                //Create Y axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(yAxisLabel);

                // X axis: scale and draw:
                var x = d3.scaleLinear()
                    .domain([0, 10])     // can use this instead of 1000 to have the max of data: d3.max(data, function(d) { return +d.price })
                    .range([0, width]);
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                // Y axis: initialization
                var y = d3.scaleLinear()
                    .range([height, 0]);
                var yAxis = svg.append("g")

                // A function that builds the graph for a specific value of bin
                function update(nBin) {

                    // set the parameters for the histogram
                    var histogram = d3.histogram()
                        .value(function (d) { return d.Cylinders; })   // I need to give the vector of value
                        .domain(x.domain())  // then the domain of the graphic
                        .thresholds(x.ticks(nBin)); // then the numbers of bins

                    // And apply this function to data to get the bins
                    var bins = histogram(data);

                    // Y axis: update now that we know the domain
                    y.domain([0, d3.max(bins, function (d) { return d.length; })]);   // d3.hist has to be called before the Y axis obviously
                    yAxis
                        .transition()
                        .duration(1000)
                        .call(d3.axisLeft(y));

                    // Join the rect with the bins data
                    var u = svg.selectAll("rect")
                        .data(bins)

                    // Manage the existing bars and eventually the new ones:
                    u
                        .enter()
                        .append("rect") // Add a new rect for each new elements
                        .merge(u) // get the already existing elements as well
                        .transition() // and apply changes to all of them
                        .duration(1000)
                        .attr("x", 1)
                        .attr("transform", function (d) { return "translate(" + x(d.x0) + "," + y(d.length) + ")"; })
                        .attr("width", function (d) { return x(d.x1) - x(d.x0) - 1; })
                        .attr("height", function (d) { return height - y(d.length); })
                        .style("fill", "#69b3a2")


                    // If less bar in the new histogram, I delete the ones not in use anymore
                    u
                        .exit()
                        .remove()

                }


                // Initialize with 20 bins
                update(20)


                // Listen to the button -> update if user change it
                d3.select("#nBin").on("input", function () {
                    update(+this.value);
                });

            });
        }

        createHistogram();

        function createConnectedScatter() {
            // set the dimensions and margins of the graph
            var margin = { top: 10, right: 100, bottom: 30, left: 30 },
                width = 600 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#connectedScatter")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            //Read the data
            d3.csv("https://raw.githubusercontent.com/IsaacMwendwa/dataViz/main/a1-cars.csv", function (data) {

                // Defining graph title and axis labels
                const xAxisLabel = "Model_Year";
                const yAxisLabel = "MPG/Cylinders/Acceleration";
                const title = `Connected Scatter Plot of ${xAxisLabel} versus ${yAxisLabel} of Cars`;

                //Create Title 
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", 0)
                    .style("text-anchor", "middle")
                    .text(title);

                //Create X axis label   
                svg.append("text")
                    .attr("x", width / 2)
                    .attr("y", height + margin.bottom)
                    .style("text-anchor", "middle")
                    .text(xAxisLabel);

                //Create Y axis label
                svg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(yAxisLabel);


                // List of groups (here I have one group per column)
                var allGroup = ["MPG", "Cylinders", "Acceleration"]
                //var allGroup = ["Displacement", "Horsepower"]

                // Reformat the data: we need an array of arrays of {x, y} tuples
                var dataReady = allGroup.map(function (grpName) { // .map allows to do something for each element of the list
                    return {
                        name: grpName,
                        values: data.map(function (d) {
                            return { Model_Year: d.Model_Year, value: +d[grpName] };
                        })
                    };
                });
                // I strongly advise to have a look to dataReady with
                // console.log(dataReady)

                // A color scale: one color for each group
                var myColor = d3.scaleOrdinal()
                    .domain(allGroup)
                    .range(d3.schemeSet2);

                // Add X axis --> it is a date format
                var x = d3.scaleLinear()
                    .domain([70, 82])
                    .range([0, width]);
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x));

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 50])
                    .range([height, 0]);
                svg.append("g")
                    .call(d3.axisLeft(y));

                // Add the lines
                var line = d3.line()
                    .x(function (d) { return x(+d.Model_Year) })
                    .y(function (d) { return y(+d.value) })
                svg.selectAll("myLines")
                    .data(dataReady)
                    .enter()
                    .append("path")
                    .attr("class", function (d) { return d.name })
                    .attr("d", function (d) { return line(d.values) })
                    .attr("stroke", function (d) { return myColor(d.name) })
                    .style("stroke-width", 4)
                    .style("fill", "none")

                // Add the points
                svg
                    // First we need to enter in a group
                    .selectAll("myDots")
                    .data(dataReady)
                    .enter()
                    .append('g')
                    .style("fill", function (d) { return myColor(d.name) })
                    .attr("class", function (d) { return d.name })
                    // Second we need to enter in the 'values' part of this group
                    .selectAll("myPoints")
                    .data(function (d) { return d.values })
                    .enter()
                    .append("circle")
                    .attr("cx", function (d) { return x(d.Model_Year) })
                    .attr("cy", function (d) { return y(d.value) })
                    .attr("r", 5)
                    .attr("stroke", "white")

                // Add a label at the end of each line
                svg
                    .selectAll("myLabels")
                    .data(dataReady)
                    .enter()
                    .append('g')
                    .append("text")
                    .attr("class", function (d) { return d.name })
                    .datum(function (d) { return { name: d.name, value: d.values[d.values.length - 1] }; }) // keep only the last value of each time series
                    .attr("transform", function (d) { return "translate(" + x(d.value.Model_Year) + "," + y(d.value.value) + ")"; }) // Put the text at the position of the last point
                    .attr("x", 12) // shift the text a bit more right
                    .text(function (d) { return d.name; })
                    .style("fill", function (d) { return myColor(d.name) })
                    .style("font-size", 15)

                // Add a legend (interactive)
                svg
                    .selectAll("myLegend")
                    .data(dataReady)
                    .enter()
                    .append('g')
                    .append("text")
                    .attr('x', function (d, i) { return 30 + i * 60 })
                    .attr('y', 30)
                    .text(function (d) { return d.name; })
                    .style("fill", function (d) { return myColor(d.name) })
                    .style("font-size", 15)
                    .on("click", function (d) {
                        // is the element currently visible ?
                        currentOpacity = d3.selectAll("." + d.name).style("opacity")
                        // Change the opacity: from 0 to 1 or from 1 to 0
                        d3.selectAll("." + d.name).transition().style("opacity", currentOpacity == 1 ? 0 : 1)

                    })
            })
        }

        createConnectedScatter();

        function createHeatmap() {
            // set the dimensions and margins of the graph
            var margin = { top: 80, right: 25, bottom: 30, left: 40 },
                width = 600 - margin.left - margin.right,
                height = 420 - margin.top - margin.bottom;

            // append the svg object to the body of the page
            var svg = d3.select("#heatmap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            //Read the data
            d3.csv("https://raw.githubusercontent.com/vjajala/dataViz/main/a1-cars.csv", function (data) {

                // Labels of row and columns -- Origin and Model_Year
                var myOrigin = d3.map(data, function (d) { return d.Origin; }).keys()
                var myModel_Years = d3.map(data, function (d) { return d.Model_Year; }).keys()

                // Build X scales and axis:
                var x = d3.scaleBand()
                    .range([0, width])
                    .domain(myOrigin)
                    .padding(0.05);
                svg.append("g")
                    .style("font-size", 15)
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).tickSize(0))
                    .select(".domain").remove()

                // Build Y scales and axis:
                var y = d3.scaleBand()
                    .range([height, 0])
                    .domain(myModel_Years)
                    .padding(0.05);
                svg.append("g")
                    .style("font-size", 15)
                    .call(d3.axisLeft(y).tickSize(0))
                    .select(".domain").remove()

                // Build color scale
                var myColor = d3.scaleSequential()
                    .interpolator(d3.interpolateInferno)
                    .domain([1, 50])

                // create a tooltip
                var tooltip = d3.select("#my_dataviz")
                    .append("div")
                    .style("opacity", 0)
                    .attr("class", "tooltip")
                    .style("background-color", "white")
                    .style("border", "solid")
                    .style("border-width", "2px")
                    .style("border-radius", "5px")
                    .style("padding", "5px")

                // Three function that change the tooltip when user hover / move / leave a cell
                var mouseover = function (d) {
                    tooltip
                        .style("opacity", 1)
                    d3.select(this)
                        .style("stroke", "black")
                        .style("opacity", 1)
                }
                var mousemove = function (d) {
                    tooltip
                        .html("Car: " + d.Car + "<br>Manufacturer: " + d.Manufacturer + "<br>Miles Per Gallon (MPG): " + d.MPG)
                        .style("left", (d3.mouse(this)[0] + 70) + "px")
                        .style("top", (d3.mouse(this)[1]) + "px")
                }
                var mouseleave = function (d) {
                    tooltip
                        .style("opacity", 0)
                    d3.select(this)
                        .style("stroke", "none")
                        .style("opacity", 0.8)
                }

                // add the squares
                svg.selectAll()
                    .data(data, function (d) { return d.Origin + ':' + d.Model_Year; })
                    .enter()
                    .append("rect")
                    .attr("x", function (d) { return x(d.Origin) })
                    .attr("y", function (d) { return y(d.Model_Year) })
                    .attr("rx", 10)
                    .attr("ry", 10)
                    .attr("width", x.bandwidth())
                    .attr("height", y.bandwidth())
                    .style("fill", function (d) { return myColor(d.MPG) })
                    .style("stroke-width", 4)
                    .style("stroke", "none")
                    .style("opacity", 0.8)
                    .on("mouseover", mouseover)
                    .on("mousemove", mousemove)
                    .on("mouseleave", mouseleave)
            })

            // Add title to graph
            svg.append("text")
                .attr("x", 0)
                .attr("y", -50)
                .attr("text-anchor", "left")
                .style("font-size", "22px")
                .text("Heatmap of Cars by Model_Year, Origin and MPG");

            // Add subtitle to graph
            svg.append("text")
                .attr("x", 0)
                .attr("y", -20)
                .attr("text-anchor", "left")
                .style("font-size", "14px")
                .style("fill", "grey")
                .style("max-width", 400)
                .text("Please hover the mouse over a Cell to get the details of the car");

            // Defining the graph's axis labels
            const xAxisLabel = "Origin of Car";
            const yAxisLabel = "Model_Year";

            //Create X axis label   
            svg.append("text")
                .attr("x", width / 2)
                .attr("y", height + margin.bottom)
                .style("text-anchor", "middle")
                .text(xAxisLabel);

            //Create Y axis label
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text(yAxisLabel);
        }

        createHeatmap();

        function createPieChart() {

                var dataset = d3.csv("https://raw.githubusercontent.com/vjajala/dataViz/main/a1-cars.csv");

                console.log([dataset]);

                var width = 400,
                    height = 400,
                    outerRadius = Math.min(width, height) / 2,
                    innerRadius = outerRadius * .999,
                    // for animation
                    innerRadiusFinal = outerRadius * .5,
                    innerRadiusFinal3 = outerRadius * .45,
                    color = d3.scaleLinear();    //builtin range of colors
                    

                var vis = d3.select("#pieChart")
                    .append("svg:svg")              //create the SVG element inside the <body>
                    .data([dataset])                   //associate our data with the document
                    .attr("width", width)           //set the width and height of our visualization (these will be attributes of the <svg> tag
                    .attr("height", height)
                    .append("svg:g")                //make a group to hold our pie chart
                    .attr("transform", "translate(" + outerRadius + "," + outerRadius + ")")    //move the center of the pie chart from 0, 0 to radius, radius
                    ;

                var arc = d3.arc()              //this will create <path> elements for us using arc data
                    .outerRadius(outerRadius).innerRadius(innerRadius);

                // for animation
                var arcFinal = d3.arc().innerRadius(innerRadiusFinal).outerRadius(outerRadius);
                var arcFinal3 = d3.arc().innerRadius(innerRadiusFinal3).outerRadius(outerRadius);

                var pie = d3.pie()           //this will create arc data for us given a list of values
                    .value(function (d) { return d.Origin; });    //we must tell it out to access the value of each element in our data array

                var arcs = vis.selectAll("g.slice")     //this selects all <g> elements with class slice (there aren't any yet)
                    .data(pie)                          //associate the generated pie data (an array of arcs, each having startAngle, endAngle and value properties) 
                    .enter()                            //this will create <g> elements for every "extra" data element that should be associated with a selection. The result is creating a <g> for every object in the data array
                    .append("svg:g")                //create a group to hold each slice (we will have a <path> and a <text> element associated with each slice)
                    .attr("class", "slice")    //allow us to style things in the slices (like text)
                    .on("mouseover", mouseover)
                    .on("mouseout", mouseout)
                    .on("click", up)
                    ;

                arcs.append("svg:path")
                    .attr("fill", function (d, i) { return color(i); }) //set the color for each slice to be chosen from the color function defined above
                    //.attr("d", arc)     //this creates the actual SVG path using the associated data (pie) with the arc drawing function
                    .attr("stroke", "black")
                    .style("stroke-width", "2px")
                    .append("svg:title") //mouseover title showing the figures
                    .text(function (d) { return d.data.category + ": " + formatAsPercentage(d.data.Origin); });

                d3.selectAll("g.slice").selectAll("path").transition()
                    .duration(750)
                    .delay(10)
                    .attr("d", arcFinal)
                    ;

                // Add a label to the larger arcs, translated to the arc centroid and rotated.
                // source: http://bl.ocks.org/1305337#index.html
                arcs.filter(function (d) { return d.endAngle - d.startAngle > .2; })
                    .append("svg:text")
                    .attr("dy", ".35em")
                    .attr("text-anchor", "middle")
                    .attr("transform", function (d) { return "translate(" + arcFinal.centroid(d) + ")rotate(" + angle(d) + ")"; })
                    //.text(function(d) { return formatAsPercentage(d.value); })
                    .text(function (d) { return d.data.category; })
                    ;

                // Computes the label angle of an arc, converting from radians to degrees.
                function angle(d) {
                    var a = (d.startAngle + d.endAngle) * 90 / Math.PI - 90;
                    return a > 90 ? a - 180 : a;
                }


                // Pie chart title			
                vis.append("svg:text")
                    .attr("dy", ".35em")
                    .attr("text-anchor", "middle")
                    .text("Revenue Share 2012")
                    .attr("class", "title")
                    ;



                function mouseover() {
                    d3.select(this).select("path").transition()
                        .duration(750)
                        //.attr("stroke","red")
                        //.attr("stroke-width", 1.5)
                        .attr("d", arcFinal3)
                        ;
                }

                function mouseout() {
                    d3.select(this).select("path").transition()
                        .duration(750)
                        //.attr("stroke","blue")
                        //.attr("stroke-width", 1.5)
                        .attr("d", arcFinal)
                        ;
                }

                function up(d, i) {

                    /* update bar chart when user selects piece of the pie chart */
                    //updateBarChart(dataset[i].category);
                    updateBarChart(d.data.category, color(i));
                    updateLineChart(d.data.category, color(i));

                }
            }

        //createPieChart();



    </script>
</body>

</html>